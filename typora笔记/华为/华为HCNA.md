云计算：通过互联网可以使用足够强大的计算机为用户提供的服务，这种

W:提示          Err：错误

exit:退出

 VM： 重新装系统： retboot

退出：startTools

关机：shutdown

# 云计算的优势：

### 1.按需自助服务

#####     根据需求选择服务（）。



### 2.广泛的网络接入

#####   在任何时间、地点，广泛的接入。



### 3.资源池化

##### 将可用资源整合以及池化。（把计算资源、存储资源、网络资源全放一起）。



### 4.快速弹性伸缩

#### 根据业务的流量，服务器可快速的进行扩容和减容。



### 5.可计量服务

##### 1、可用监控服务，帮助我们收费用。

#####  2、优化我们的架构（根据白天黑夜自动调节服务质量。）

# 计算发展史：

### 1、串行计算：

### 2、并行计算（服务器使用）：同时运行

### 3、分布式计算：拿两台或者多台计算机同时计算

### 4、网格计算

使用不同场商的设备计算（电脑、服务器、笔记本）

### 5、云计算：通过互联网提供服务

# 云计算的部署模式

### 1、公用云

 云产商搭建的云平台

### 2、私有云（数据库）

企业自己搭建给企业内部使用（企业自建自用 )

### 3、混合云

公用云+私有云=混合云

![](F:\Typora\笔记图片\ICT\HCIA-1\混合云.png)

# 虚拟化的优势：

### 1、提高资源利用率

### 2.可移植性强

虚拟机的底层形式文件： 磁盘文件：虚拟机的磁盘在底层的存放形式，不同的虚拟化不同的格式

配置文件：虚拟机的配置信息（网卡信息、CPU信息、系统的信息）

# 1型虚拟化

vmm层位于硬件之上，性能好，应用服务器上。

产品：Fusioncompute(华为) ，   Vspere

![虚拟化](F:\Typora\笔记图片\ICT\HCIA-1\虚拟化.png)



# 2型虚拟化

虚拟化层是在操作系统之上（软件实现），应有个人电脑上。

产品：vmware workstation， virtbox(甲骨文)

# 虚拟机的特点：

##  分区、隔离、封装、独立

# 计算虚拟化（）

敏感指令(对虚拟机开机、重启、删除)：在X86的架构的虚拟化中才有敏感指令

## X86的架构

CPU:处理操作系统下发的指令，并将处理的结果返回给系统。用户只给CPU特权指令和敏感指令这两种指令。

### cpu虚拟化

#### 全虚（将所有指令都收集）

##### 优势：不需要修改guest os

##### 缺点：虚拟化层的开销大



#### 半虚：(将16条指令直接交给vmm)

##### 优势:虚拟化层的开销小

##### 缺点：修改操作系统



#### 硬虚：（硬件辅助虚拟化，cpu支持虚拟化）

##### 优势：性能好

##### 缺点：要cpu支持虚拟化



## 内存虚拟化

#### 1、内存空间必须从1开始，

#### 2、空间连续，内存的映射



### 全虚

#### 优势：虚拟化层的开销小

#### 缺点：虚拟化是无感知的（虚拟化运行在虚拟化层上《不在硬件上》）



#### 半虚：

#### 优势：性能好。

#### 缺点：虚拟化是有感知的 。



I/o设备：Input/output、磁盘、网卡

## IO虚拟化（输入、输出设备 例：键盘和鼠标）





RISC精简指令集

CISC复杂指令集

## KVM技术：

### 三部分

#### QEMU:实现操作硬盘（）鼠标、网卡。。。

#### Libvirt(管理虚拟机的):屏蔽虚拟化平台的差异

Libvirt:c语言        ，Libvirt进程：操作虚拟化平台

设计了api借口（c#,python,java...）

## fusionCompute

只有CNA没有VRM一样可以使用。

### CNA：具体执行虚拟化的

### VRM:管理组件

# 网络虚拟化

## 东西、南北流量：

##### 东西流量：不经路由器的

##### 南北流量：经路由器的

## 网络基本感念：

##### 路由：

跨广播域进行通信，从一个广播域去到另外一个广播域，中间的路就是路由。

##### vlan端口

两种不同类型的端口组 ： 

​                         1.中继 ：对应Trunk（可多个VLAN,用来连接交换机的）   

​                         2.普通：对应Access（只能一个VLAN）

## 物理网络：

## TCP/IP协议（栈）四层模型

###### 网络接口层(物理连接和借口)

###### 网络层(IP)

###### 传输层（TCP/UPD)

###### 应用层（各种应用）

##  OSI参考模型

###### 物理层-建立和维护物理连接

###### 数据链路层-建立逻辑连接，硬件地址寻址、差错效验

###### 网络层-进行逻辑地址寻址，实现不同的网络之间的路径选择

###### 传输层-定义数据传输的协议和端口

###### 会话层

###### 表示层

###### 应用层

## 服务器接入网络的两种方式

###### TOR(柜顶接入)：

在每个柜的放一台交换机(柜顶 或柜底 或柜中都行)

##### EOR(列头接入)：

有放专门的交换机柜，所有的设备都往机交换机柜接的（柜放列顶 或列中 或列底都行）

## 虚拟网络：

### **开放的虚拟交换机** - Open vSwitch（OVS）<要Linux系统>

QOS：服务质量保证（对虚拟机限速，保证指定虚拟机网速）例：保证VIP网络

#### 为什么要OVS:

###### 状态可移植

###### 适应动态网络

###### 支持逻辑标签的维护

###### 支持硬件集成

### 分布式虚拟交换机（DVS)

注意：DVS是二层交换机

#### DVS特点：

######          1.集中管理：通过统一的Portal页面进行集中管理，简化用户配置

######        2.基于OVS设计的：充分基础OVS的优势

######       3.丰富的二层特性：交换、QoS、安全隔离（VLAN、安全组）

## fc网络架构

### DVS：

###### 端口组：网络属性（VLAN）相同的一组端口的集合

###### 上行链路：DVS连接物理机网口的链路

## 交换模式：

###### 普通：

###### SR-IOV(要特殊的网卡)：直通模式（将物理网卡直接直通改虚拟化环境使用）

###### 用户交互模式(要特殊的网卡)：

# 存储虚拟化：

## 常见物理磁盘类型

### 机械硬盘（HDD)

###### SATA

###### NL_SAS

###### SAS

### 固态硬盘（SSD）

## 集中式存储和分布式存储

### 集中式存储：专门有一个服务器，用来存储资源。

#### RAID技术（冗余磁盘阵列）:

优点：高效：多块磁盘并行读写       安全：



##### RAID 10：最少要四个硬盘

##### RAID 50:最少要6个硬盘

#### SAN:存储区域网络

![](F:\Typora\笔记图片\ICT\HCIA-1\IP-SAN与FC-SAN对比.png)

#### NAS:网络附加存储

NAS两种方案：1.CIFS；   2.NFS

![](F:\Typora\笔记图片\ICT\HCIA-1\GIFS与NFS对比.png)

### 分布式存储：  利用所有的计算服务器剩余的硬盘，组织成一个大型的资源池使用。

副本机制：DHT算法

文件系统：文件的分层组织结构，操作系统有了文件系统后，数据以文件和文件夹得形式体现，可以做到文件的复制、粘贴、删除和恢复。

格式化：重新写入文件系统

物理网络包含的设备：

###### 交换机有24和48接口。

路由器一般只有2~4个接口。

1.二层交换机(数据链路层)：数据转发，同网段同信，接入设备

2.三层交换机（网络层）：拥有二层交换机的功能，具备路由功能

3.路由器（云计算中网络接口只用出口）：进行跨网络通信的设备

4.网卡

5.AC

6.AP

7.Firewall(防火墙)







# fusioncompute(虚拟化产品(简称：fc))

1、功能：实现虚拟化

2、版本：6.1（xen建构） ，6.3-6.5（kvm建构），8.0（支持arm<鲲鹏cpu>建构的cpu）

3.建构cna vrm

4.服务器使用的

# fusionspere(虚拟化套件):包括fusioncompute产品

控制面板：网络连接 ncpa.cpl

1.IP地址/子网掩码/网关（例：门）

网关的设置：三层交换机的vlanif接口，路由器的接口，网关和IP地址是同一个网段

2.MAC地址（物理、硬件地址）

funsion Compute把物理机转换成hypervisor，在hypervisor上创建虚拟机

funsion Compute一个逻辑集群可以容纳128个物理机，每个逻辑群支持8000台虚拟机。VRM可支持（虚拟（虚拟机管理少）、物理（虚拟机管理多））主备部署

# VLAN:

VLAN虚拟局域网（用路由器连接两个不同的VLAN）：在逻辑上讲我们的网络划分成多个小的广播域的通信技术

作用：限制广播域，增强局域网的完全性，提高网络的健壮性，使网络更加灵活



网卡：NIC                  虚拟网卡：VNIC







# NAT（NAT地址转换方案）:

 好处：1、把仅有的一个地址转换成多个

​          2、对虚拟机有保护作用（地址多黑客不知道攻击那个）

​          3、负载均衡（只能是做同一种活的）



# 虚拟机流量流向

1.虚拟机运行在相同的主机上，端口组不同：访问流量从主机内部出到物理的接入交换机，经过三层设备的转发然后再进入到主机内部。

2.虚拟机运行在相同的主机上，端口组相同：属于同一个广播域，二层通信，DVS支持二层通信的，可以直接在DVS内部完成流量的转发。

3.虚拟机运行在不同的主机上，端口组相同：使用相同的端口组，应该由DVS内部转发流量，但是主机不同，所以这个时候需要借助外部的物理交换机进行流量转发。

4.虚拟机运行在相同的主机上，但是DVS不同：使用不同DVS的目的就是为了隔离，所以是不能通信的，如果确实需要通信，需要借助外部的三层设备进行通信。







# 磁盘

逻辑卷：FusonStorage Block

本地硬盘是存储设备，

##### 磁盘类型:

从属:1快照中包含该磁盘.    2数据永久写入.

持久:数据永久写入.

非持久:当用户的电脑断电 /重启,数据清零.

##### 虚拟机集群特性：

集群：把一组计算机（主机）组合起来形成一个整体，向用户提供资源的方式（计算、存储、网络资源）

###### 特性：

1.HA：集群可高可用特性，克服单台主机的局限性，做到当要某台物理主机出现故障时业务部中断或中断时间较少的效果，集群一般要求使用共享存储。

2.负载均衡：将特定的业务分担改多台设备或多台链路，从而提高业务处理能力。

###### 特性2：

优势：将业务均匀的分配到多台设备上，提高整体性能。

可扩展性:负载均衡技术可以方便的去增加集群中设备或链路的数量。

高可靠性：单个甚至多个设备发生故障，也不会导致业务中断。

可管理性：管理员可以方便进行集中管理。

透明性：对用户透明，用户感知不到也不必要知道网络结构。

###### 特性3：

易扩容：在虚拟化中，承载业务虚拟机的所有资源来源于资源池，当业务扩展的需要增加资源，只需要去增加资源池中的资源即可。

###### 特性4：

注意：内存气泡、内存置换、内存共享必须同时使用

​      内存复用（复用比：150%）：在物理服务器资源一定的情况，通过综合运用内存复用的单项技术（内存气泡、内存置换、内存共享）对内存进行分时复用，是虚拟机内存的规格总和大于物理服务器的内存规格。

​    内存气泡：系统自动回收虚拟机暂时使用不上的内存，分配改需要使用的虚拟机；内存在回收和分配均为系统自动执行，虚拟机无感知。

​    内存置换：将虚拟机长时间为访问的内存容量置换到外部存储中，并建立映射关系，当虚拟机需要使用的时候，再进行交换。

​    内存共享：多台虚拟机共享同一物理内存空间，此时虚拟机只对内存做只读操作；当虚拟机需要对内存进行写操作时，另外开辟一内存空间，并修改映射。

​     价值：

​     1.当计算节点的内存数量固定的时候，可以提高计算节点上虚拟机的数量

​       2.当计算节点是哪个虚拟机的数量一定的是时候，可以节省计算节点的内存数量。

##### 虚拟机特性：

​     虚拟机的快速部署:可以通过模板或克隆的方式实现虚拟机的快速部署。

###### 特性1：

   模板部署虚拟机：模板本质也是一台虚拟机，同样包含磁盘文件和配置文件。使用模板能够节省配置新虚拟机和安装操作系统的时间，模板部署出来的虚拟机是相互独立的，适用于大批量部署虚拟机。可以保证虚拟机系统的一致性，同时还能去除差异性参数（IP,SID(身份证),MAC（虚拟机网卡的物理地址））.

​    虚拟机克隆：使用虚拟机本身快速部署出一台虚拟机，虚拟机克隆是在某一个时间点对源虚拟机进行的完全复制。被克隆出来的虚拟机和源虚拟机配置信息一模一样，包括IP，SID,MAC。

###### 特性2：

​        虚拟机资源的热添加：在虚拟机处于开机状态的时候增加虚拟机的计算、存储、网络等资源。

​       虚拟机的Console控制：可以不依赖虚拟机的网络，对虚拟机进行控制和管理。

​      虚拟机快照：快照是虚拟机特定数据集的完整可用拷贝，该数据集包含数据在拷贝点的静态映像。一般应用于对虚拟机进行升级、打补丁、测试等破坏性操作前，一旦虚拟机出现故障，可以通过快照进行快速的恢复。

​       快照的模式：

   1.ROW(写时复制)    ：当需要写时，直接写入日志，读源卷时，先检索日志；读快照时，需要引用源卷。

​     COW(写前拷贝)： 当需要写时，需要将原来的数据拷贝至专用空间再建立索引。    

NUMA(非统一访问内存)：是一种提高数据读写速度的技术，使用NUMA技术可以让虚拟机使用同一NUMA Node上的硬件资源，以提高虚拟机的响应速度。

# 华为虚拟化特性：

Tools:一切高级特性的前提，

## 集群特性：

![](F:\Typora\笔记图片\ICT\HCIA-1\华为虚拟机集群特性.png)

负载均衡：

​     DRS(动态资源调度)：可以通过一定的规则对虚拟机进行迁移。

​      DRS规则：1.聚集虚拟机，2.互斥虚拟机，3.虚拟机到主机（必须在<不在>)，应该在<不在>）

​    优先级：虚拟机到主机（虚拟机必须在主机（组）上运行-----> 虚拟机必须 不在主机（组）上运行）----->聚集虚拟机------>互斥虚拟机------>虚拟机到主机（虚拟机应该在主机（组）上运行------->虚拟机应该 不在主机（组）上运行）

​    DPM(分布式电源管理)：自动的根据集中服务器资源的使用情况，对多余的主机进行下电处理。（重载分离，轻载合并，空载下电）

 

IMC(CPU策略集，及支持英特尔，和小版本间更新)

要求：

​      1.集群下主机的CPU功能集必须等于或高于设置的目标基准功能集。

​    2.集群下运行或休眠状态的虚拟机CPU功能集必须等于或低于目标基准功能集。如果存在不满足条件的虚拟机，需要将改虚拟机关机或迁移出改集群后设置。



# 华为fusionCompute安装



## 安装第一台CNA

## 安装VRM

### 注意：安装完的VRM跟CNA看上去没啥区别。也就安装包中的_VRM.iso或_CNA.iso能区分出来。

IP后面的130不跟后面的相同，图中IP后的0写错啦

搞完可以打VRM的IP登录fc

![](F:\Typora\笔记图片\ICT\HCIA-1\实验fusionCompute方法3：镜像安装CNA和VRM\VRM1.png)

![](F:\Typora\笔记图片\ICT\HCIA-1\实验fusionCompute方法3：镜像安装CNA和VRM\VRM2.png)

## 安装第二台CNA

![](F:\Typora\笔记图片\ICT\HCIA-1\实验fusionCompute方法3：镜像安装CNA和VRM\第二台CNA.png)

![](F:\Typora\笔记图片\ICT\HCIA-1\实验fusionCompute方法3：镜像安装CNA和VRM\第二台CNA的网关.png)



手工安装没有集群

工具安装会自动创建一个ManagementCluseter集群和添加第一个主机（需要自己加第二个主机）



virsh Destroy 计名：摧毁虚拟机    virsh  start  计名:启动虚拟机

虚拟机HA：从故障的虚拟机自动迁移正常的主机。

​        一致性快照：把当前未保存的东西保存好，再进行快照。

​         内存快照：当前是什么样，快照就什么样。

ECS:云服务器



  传统架构： 

​     1.找运营商拉网线

​     2.组装（买）台服务器 或电脑

​     3.装Linux操作系统

​     4.写代码（软件）

​      5.发布软件

   Laas:  1.买ECS(云服务器)

​               2.给ECS装操作Linux系统

​              3.装编程环境

​              4.写代码（软件）

​    Paas:写代码（软件）就行了

​    Saas:直接用就行了 例：知乎，小红书。。。

