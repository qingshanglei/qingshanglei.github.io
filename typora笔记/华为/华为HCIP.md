# FusionCompute产品介绍：

FusionCompute虚拟化产品，FusionCompute在FusionSplere虚拟化套件中。

虚拟化-云软件的基石

华为公、私有云都是基于Openstack做的。

华为云Stack(HCS):华为私有云

NFVI(电信运云商解决方案)

## FusionSphere虚拟化套件特点：

### 管理至简

###### 多站点统一管理（可支持256个站点同时管理，统一运维）

###### 异构纳管VMware(兼容其他虚拟化产品)

### 性能至优

###### 大规模虚拟机

###### 高性能虚拟化能力

###### GPU增强

Firewall( 防火墙)

FusionCompute云操作系统软件，主要 负责硬件资源的虚拟化，对虚拟资源、业务资源（虚拟化平台上运行的虚拟机）、用户资源的集中管理。

市电：城市居民用电/

UPS(大型充电宝):稳压

UVP =KVM =Xen

## FusionCompute模块功能：

#### CNA和VRM的功能：



####      CNA(Computing Node Agent, 计算节点代理)：

主要提供虚拟化功能，通常以集群的方式部署，将集群内的资源（计算、存储、网络）提供给用户使用。

####      VRM(Virtual Resource Manager,虚拟资源管理)：

 为管理员提供Portal页面，方便用户对FusionCompute进行管理和使用。

## FusionCompute产品功能

#### 1.虚拟化计算

  虚拟化计算：将物理服务器抽象成逻辑资源，让一台服务器变成几台甚至几百台服务器。

#### 2.虚拟化存储：

  将存储设备抽象成数据存储，然后分配给虚拟机使用，虚拟机以文件的形式存放在数据存储当中。

#### 3.虚拟化网络：

每个虚拟机都有虚拟网卡（VNIC），虚拟网卡具备IP地址/MAC。从虚拟机角度，虚拟网卡和物理网卡一致。虚拟网卡连接DVS的端口组，DVS使用上行链路和物理网络相连。

## FusionCompute的价值：

#### 1.提高资源的利用率：

  1、资源共享   2、分时共享

#### 2.提高业务的可靠性：

 

服务器线：1.VMC(控制服务器，控制口)     2.VNC（业务口，）

# FusionCompute计算虚拟化

## 什么是虚拟化：

   虚拟化是一种在软件中仿真硬件的技术，将多个物理设备同归软件定义的方式抽象成一个逻辑设备，在抽象成多个逻辑设备，事项精细化管理资源。虚拟化是一个抽象层，打破物理硬件和操作系统之间的硬件连接，实现上层操作系统和底层硬件解耦，操作系统的资源来源于资源池。

##      虚拟化本质：

######          分区：

虚拟化层具备为每一个虚拟机划分独立的虚拟资源的能力，每个虚拟机可以运行一个单独的操作系统，操作系统只能看到虚拟化层提高的虚拟硬件。

   解决问题：防止资源的超额分配；每个虚拟机是独立的操作系统，互不影响，让操作系统以为自己运行在专用的服务器上。

######          隔离：

###### 通过分区所建立起来的逻辑隔离措施，防止相互影响。

​      解决问题：一个虚拟机故障，不会导致其他虚拟机故障。

######          封装：

 意味着整个虚拟机（硬件配置、BIOS设置、磁盘、CPU、内存等）都存储在文件或文件夹中，只需要复制文件即可复制虚拟机。

######          相对于硬件独立：

 虚拟机因为封装，变成了文件和文件夹，虚拟机迁移就只需要复制配置文件和磁盘文件到另外一个主机即可，不需要关心底层的硬件是否兼容，顶层硬件的差异性被Hypervisor给屏蔽了。值需要知道母的主机是否存在相同的Hypervisor.

## 计算虚拟化的分类：



![](F:\Typora\笔记图片\ICT\HCIP-2\计算虚拟化的分类.png)







## CPU虚拟化：

## 虚拟化问题：

###### 模式CPU指令：



###### 让多个VM共享CPU:

利用与Native操作系统类型的机制-通过定时器中断，在中断触发时陷入VMM,从而根据

调度机制进行调度。

## CPU与VCPU对应关系：

VCPU(虚拟CPU)    

PHY kernel(核心)

Super Thread(线程/逻辑处理器)

2个CPU(2U或2Node)

![](F:\Typora\笔记图片\ICT\HCIP-2\CPU与VCPU对应关系.png)

## 内存虚拟化：

### 内存虚拟化

VMM：操作系统

Guest         Virtual       Address

物理机的物理内存：HPA

物理机的虚拟内存：HVA  = GPA

虚拟机的物理内存：GPA

虚拟机的虚拟内存：GVA

每个虚拟机对应到一个影子页表

### 影子页表：

通过软件实现重客户计虚拟地址到宿主机物理地址的直接转换。

缺点： 1.实现难度大。（开发、调试）

​            2.物理内存开销大。

### 扩展页表技术（EPT)：

Intel的GPU提供EPT技术，直接在硬件上支持GVA-GPA-HPA的地址转换，从而降低内存虚拟化实现的复杂度，提升内存虚拟化性能。NPT也行。

## I/O虚拟化（Input/O）：

模拟设备：完全有QEMU纯软件模拟的设备

Virtio设备：实现VIRTIO API的半虚拟化设备

PCI设备直接分配（PCI device assignment）

### 全模拟：

### virtio:

###### 虚拟出特殊的设备：

1.特殊的设备驱动，包括VM中的Front-end驱动和主机上的Back-end驱动

2.Front-end和Back-end驱动之间的高效通信

###### 减少VM和主机的数据输出开销：

1.内存共享（Virt RING)

2.Batched I/O

3.异步事件通知Eventfd轻量级进程间“等待/通知”机制

### PCI设备直接分配：



### 支持GPU虚拟化，GPU直通：

# FusionCompute存储虚拟化：

NAS共享目录：ClFS ,    NFS

### VIMS虚拟集群存储文件系统：

###### lVIMS是一种高性能的集群文件系统，使虚拟化技术的应用超出了单个存储系统的限制，可让多个虚拟机共同访问一个整合的集群式存储池，从而显著提高了资源利用率。VIMS 是跨越多个存储服务器实现虚拟化的基础，它可启用存储热迁移、DRS（Storage Dynamic Resource Scheduler） 和High Availability 等各种服务。

### VIMS分布式锁：

###### VIMS采用分布式全对称锁机制。在VIMS中不会集中在同一节点上，无管理中心节点。

###### 正常情况下成为某个锁资源的Master方式有两种：

1.第一个申请访问某资源的节点

2.如果多节点同时访问某资源，以VIMS节点号较小的节点作为master

###### 当节点发生故障时，此节点负责管理的资源会重新选举出master.

### VIMS心跳：

###### 磁盘心跳：

用于检测主机是否可以正常读写共享存储。

###### 网络心跳：

用于检测主机间网络通信是否正常。

## FusionCompute磁盘技术：

#### 快照：

##### 普通快照：

###### 只能保存硬盘里的数据。

##### 一致性快照：

######  先把内存的数据写入硬盘后，再打快照。

##### 内存快照：

######  直接将内存里的东西打成快照。

#### 快照相关原理：

##### 创建快照：

把原磁盘变成只读磁盘，再基于原磁盘生成一个差分磁盘文件，虚拟机在原磁盘读，在差分磁盘写。

##### 回滚开招（还原快照）：

把差分磁盘删除，然后基于原磁盘重新建立一个差分磁盘。在原磁盘读，在差分磁盘写。

##### 删除快照：

将差分磁盘和原磁盘合并，再把差分磁盘删除。

#### 链接克隆：

把原虚拟机变成母盘，基于母盘数据创一个差分盘，

# 网络虚拟化：





## Linux Bridge(网桥)介绍：

虚拟机跟虚拟机无法网络隔离，



## OVS(以太网交换机)：

OVS能够支持多种标准的管理接口和协议，还可以支持跨多个物理服务器的分布式。

OVS提供了对OpenFlow协议的支持，并且能够与众多开源的虚拟化平台相整合。

#### 为什么要OVS:

 1.状态可移植。

2.相应动态网络。

3.支持逻辑标签维护。

4.支持与硬件集成。

#### 作用：

传递虚拟机VM之间的流量，以及实现VM和外界网络的通信。

## EVS(华为)：

## 虚拟机通信：

同主机同DVS同端口组可通信。



### 网络安全组：

ping 采用的是ICMP协议。

MTU:1500~9000

华为虚拟交换模式：

![](F:\Typora\笔记图片\ICT\HCIP-2\华为虚拟交换模式.png)

普通模式：

SR-IOV直通模式：

用户态交换模式：

## 网络安全策略-二层网络安全策略：

二层网络安全策略主要包括：防止用户虚拟机IP和MAC地址仿冒，防止用户虚拟机DHCP Server仿冒。

二层网络安全策略：主要对端口组的

DNS:域名解析

![](F:\Typora\笔记图片\ICT\HCIP-2\网络安全策略-二层网络安全策略.png)

## 网络安全策略-广播报文抑制：



## 网络安全策略-安全组（入方向白名单）：

安全组：采取白名单策略（在名单里的才可通行  ）

## Trunk口：

Trunk口：fc中对应中继

Trunk口（默认VLAN 1可通过）：

Trunk口：进（进交换机里）

PVID

#### 入（带标，不带标）：

白色不带标进，拿PVID变蓝色

#### 出（一定带标）：

蓝色出接口相同 接口去掉，出去变白色（无标）。

## 网络Qos（服务质量保证）：

网络Qos策略提供带宽配置控制能力，包括如下方面：

   1.基于端口组成员接口发送方向与接收方向的带宽控制。

​     2.基于端口组的每个成员接口提供流量整形、带宽优先级的控制能力。

## 网卡绑定：

只支持普通网卡和pptk网卡

Mgnt：聚合接口

# 虚拟机发放与管理：

## 计算机资源管理：

集群管理：

BMC（服务器基本界面）：上电操作  

 DPM:上电和下电操作



主机管理：

# 虚拟机发放与管理：

### 协议：

TCP或CDP：专门用于电脑通信的

ICMP:专门针对ping的

Any:不限制任何协议

### 端口范围：

http:80                           https:443



克隆虚拟机：只



# SecureCRT应用：

用户：gandalf

密码：laaSEOS-CLOUD9!

windows server 2012 r2秘钥



1.安装域控制器

2.配置DNS DHCP

3.创建用户/组

4.安装监控代理

# fA实验：

默认的端口组不同，建一个端口组FA

AD和ITA都要挂载以下镜像才能使用。

AD:挂载cn_windows_server_2012_r2_64_dvd_2707961.iso镜像

ITA:挂载FusionAccess_Euler_Installer_V100R006C20SPC100.isc镜像

12-19-2 32